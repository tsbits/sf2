var Degas=function(t){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.fullClear=!0,this.clearColor="rgba(0,0,0,0.25)",this.children=[],this.totalChildren=0,this.mouseEvent=!1,this.mouseStyle=!0,this.mouse={x:void 0,y:void 0},this.scaleRatio=1,this.currentFrame=0};Degas.prototype.enableMouse=function(){var t=this;this.mouseEvent=!0,this.canvas.addEventListener("mousemove",function(e){t.mouse.x=e.offsetX,t.mouse.y=e.offsetY},!1),this.canvas.addEventListener("click",function(e){for(var i=0;i<t.children.length;i++)if(void 0!=t.children[i].events.click.callback&&t["mouseover"+t.children[i].type](t.children[i])){var e={target:t.children[i],type:"click"};t.children[i].events.click.callback(e)}},!1)},Degas.prototype.disableMouse=function(){this.mouseEvent=!1,this.canvas.removeEventListener("mousemove",function(t){var e=this.canvas.getBoundingClientRect();this.mouse.x=t.clientX-e.left,this.mouse.y=t.clientY-e.top},!1)},Degas.prototype.enableMouseStyle=function(){this.mouseStyle=!0},Degas.prototype.disableMouseStyle=function(){this.mouseStyle=!1},Degas.prototype.resize=function(t,e){if(window.devicePixelRatio>1){var i=this.canvas.width,s=this.canvas.height;this.canvas.width=i*window.devicePixelRatio,this.canvas.height=s*window.devicePixelRatio,this.canvas.style.width=i,this.canvas.style.height=s,this.ctx.scale(window.devicePixelRatio,window.devicePixelRatio)}this.canvas.width=t,this.canvas.height=e},Degas.prototype.addChild=function(t){this.totalChildren++,t.uid=this.totalChildren,this.children.push(t)},Degas.prototype.removeChild=function(t){for(var e=0;e<this.children.length;e++)if(this.children[e].uid==t.uid){this.children.splice(e,1);break}},Degas.prototype.getChildIndex=function(t){for(var e=void 0,i=0;i<this.children.length;i++)if(this.children[i].uid==t.uid){e=i;break}return e},Degas.prototype.bringToFront=function(t){for(;this.getChildIndex(t)<this.children.length-1;)this.swapChildIndex(this.getChildIndex(t),this.getChildIndex(t)+1)},Degas.prototype.bringForward=function(t){this.getChildIndex(t)<this.children.length-1&&this.swapChildIndex(this.getChildIndex(t),this.getChildIndex(t)+1)},Degas.prototype.bringBackward=function(t){this.getChildIndex(t)>0&&this.swapChildIndex(this.getChildIndex(t),this.getChildIndex(t)-1)},Degas.prototype.sendToBack=function(t){for(;this.getChildIndex(t)>0;)this.swapChildIndex(this.getChildIndex(t),this.getChildIndex(t)-1)},Degas.prototype.swapChildIndex=function(t,e){return this.children.splice(e,0,this.children.splice(t,1)[0]),this},Degas.prototype.getMetName=function(t){console.log(this.drawRectangle)},Degas.prototype.empty=function(){for(;this.children.length>0;)this.children.pop()},Degas.prototype.render=function(){this.currentFrame++,this.fullClear?this.ctx.clearRect(0,0,window.innerWidth,window.innerHeight):(this.ctx.fillStyle=this.clearColor,this.ctx.fillRect(0,0,window.innerWidth,window.innerHeight));for(var t=0;t<this.children.length;t++){var e=this.children[t];this.ctx.save(),void 0!=e.group&&(this.ctx.translate(e.group.x,e.group.y),this.ctx.rotate(Degas.degreeToRadian(e.group.rotation)),this.ctx.scale(e.group.scaleX,e.group.scaleY),this.ctx.globalAlpha=e.group.opacity),void 0!=e.mask&&(this.ctx.translate(e.mask.x,e.mask.y),this.ctx.rotate(Degas.degreeToRadian(e.mask.rotation)),this.ctx.scale(e.mask.scaleX,e.mask.scaleY),this.ctx.globalAlpha=e.mask.opacity,this["draw"+e.mask.type](e.mask),this.ctx.translate(-e.mask.x,-e.mask.y),this.ctx.clip()),this.ctx.translate(e.x,e.y),this.ctx.rotate(Degas.degreeToRadian(e.rotation)),this.ctx.scale(e.scaleX,e.scaleY),this.ctx.globalAlpha=e.opacity,this.ctx.globalCompositeOperation=e.blendMode,this["draw"+e.type](e),""!=e.fill&&(this.ctx.fillStyle=e.fill,this.ctx.fill()),""!=e.stroke&&(this.ctx.strokeStyle=e.stroke,this.ctx.lineWidth=e.strokeWidth,this.ctx.lineCap=e.lineCap,this.ctx.lineJoin=e.lineJoin,this.ctx.stroke()),this.ctx.translate(-e.x,-e.y),this.ctx.scale(1,1),this.ctx.rotate(-1*Degas.degreeToRadian(e.rotation)),this.ctx.restore()}if(this.mouseEvent){for(var t=0;t<this.children.length;t++)if(void 0!=this.children[t].events.mouseover.callback){if(this["mouseover"+this.children[t].type](this.children[t])&&!this.children[t].events.mouseover.fired){var i={target:this.children[t],type:"mouseover"};this.children[t].events.mouseover.fired=!0,this.children[t].events.mouseover.callback(i),this.children[t].events.mouseout.fired=!1}if(this.children[t].events.mouseover.fired&&!this.children[t].events.mouseout.fired&&!this["mouseover"+this.children[t].type](this.children[t])&&(this.children[t].events.mouseout.fired=!0,this.children[t].events.mouseover.fired=!1,void 0!=this.children[t].events.mouseout.callback)){var i={target:this.children[t],type:"mouseout"};this.children[t].events.mouseout.callback(i)}}for(var s=!1,t=0;t<this.children.length;t++)if((void 0!=this.children[t].events.mouseover.callback||void 0!=this.children[t].events.click.callback)&&this["mouseover"+this.children[t].type](this.children[t])){s=!0;break}this.mouseStyle&&(s?this.canvas.style.cursor="pointer":this.canvas.style.cursor="default")}},Degas.prototype.drawCube=function(t){this.ctx.beginPath(),this.ctx.rect(-t.width/2,-t.height/2,t.width,t.height),this.ctx.closePath()},Degas.prototype.drawRectangle=function(t){this.ctx.beginPath(),this.ctx.rect(-t.width/2,-t.height/2,t.width,t.height),this.ctx.closePath()},Degas.prototype.drawCircle=function(t){this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,0,2*Math.PI,!1),this.ctx.closePath()},Degas.prototype.drawPath=function(t){if(this.ctx.beginPath(),t.smoothed){if(t.smoothed)if(t.smooth(),t.closed){if(t.closed){this.ctx.moveTo(t.smoothedPoints[t.smoothPointsNumber].x,t.smoothedPoints[t.smoothPointsNumber].y);for(var e=t.smoothPointsNumber+1;e<t.smoothedPoints.length-t.smoothPointsNumber;e++)this.ctx.lineTo(t.smoothedPoints[e].x,t.smoothedPoints[e].y)}}else{this.ctx.moveTo(t.smoothedPoints[0].x,t.smoothedPoints[0].y);for(var e=1;e<t.smoothedPoints.length;e++)this.ctx.lineTo(t.smoothedPoints[e].x,t.smoothedPoints[e].y)}}else{this.ctx.moveTo(t.points[0].x,t.points[0].y);for(var e=1;e<t.points.length;e++)this.ctx.lineTo(t.points[e].x,t.points[e].y);t.closed&&this.ctx.closePath()}},Degas.prototype.drawRegularPolygon=function(t){this.drawPath(t.path)},Degas.prototype.drawArc=function(t){this.ctx.beginPath(),this.ctx.arc(0,0,t.radius,Degas.degreeToRadian(t.startAngle),Degas.degreeToRadian(t.endAngle),t.antiClockwise),this.ctx.closePath()},Degas.prototype.drawImage=function(t){this.ctx.drawImage(t.img,-t.width/2,-t.height/2)},Degas.prototype.drawSprite=function(t){this.ctx.drawImage(t.img,t.width*t.currentFrame,0,t.width,t.height,-t.width/2,-t.height/2,t.width,t.height)},Degas.prototype.drawText=function(t){this.ctx.fillStyle=t.fill,this.ctx.font=t.fontStyle+" "+t.fontSize+" "+t.fontFamily,this.ctx.textAlign=t.textAlign,this.ctx.fillText(t.txt,0,0)},Degas.prototype.mouseoverCircle=function(t){return Degas.distanceBetween(t,this.mouse)<t.radius},Degas.prototype.mouseoverCube=function(t){return this.mouse.x>t.x-t.width/2&&this.mouse.x<t.x+t.width/2?this.mouse.y>t.y-t.height/2&&this.mouse.y<t.y+t.height/2:!1},Degas.prototype.mouseoverRectangle=function(t){return this.mouse.x>t.x-t.width/2&&this.mouse.x<t.x+t.width/2?this.mouse.y>t.y-t.height/2&&this.mouse.y<t.y+t.height/2:!1},Degas.prototype.mouseoverRegularPolygon=function(t){var e={x:this.mouse.x-t.x,y:this.mouse.y-t.y};return Degas.pointInPolygon(t.path.points,e)},Degas.prototype.mouseoverImage=function(t){return this.mouse.x>t.x-t.width/2&&this.mouse.x<t.x+t.width/2?this.mouse.y>t.y-t.height/2&&this.mouse.y<t.y+t.height/2:!1},Degas.prototype.mouseoverSprite=function(t){return this.mouse.x>t.x-t.width/2&&this.mouse.x<t.x+t.width/2?this.mouse.y>t.y-t.height/2&&this.mouse.y<t.y+t.height/2:!1},Degas.BaseShape=function(){this.uid=0,this.x=0,this.y=0,this.blendMode="source-over",this.rotation=0,this.scaleX=1,this.scaleY=1,this.opacity=1,this.fill="",this.stroke="",this.strokeWidth=1,this.lineCap="butt",this.lineJoin="miter",this.mask,this.group,this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Degas.BaseShape.prototype.addEventListener=function(t,e){void 0!=this.events[t]&&(this.events[t].fired=!1,this.events[t].callback=e)},Degas.Cube=function(t){this.type="Cube",this.width=t||50,this.height=t||50,this.size=t||50,this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Degas.Cube.prototype=new Degas.BaseShape,Degas.Cube.prototype.setSize=function(t){void 0==t||null==t||isNaN(parseFloat(t))||(this.width=t,this.height=t,this.size=t)},Degas.Rectangle=function(t,e){this.type="Rectangle",this.width=t||150,this.height=e||100,this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Degas.Rectangle.prototype=new Degas.BaseShape,Degas.Circle=function(t){this.type="Circle",this.radius=t||50,this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Degas.Circle.prototype=new Degas.BaseShape,Degas.RegularPolygon=function(t,e){this.type="RegularPolygon",this.radius=t||50;for(var i=e||5,s=[],o=2*Math.PI/i,h=0;i>h;h++)s.push(new Degas.Point(this.radius*Math.sin(o*h),this.radius*Math.cos(o*h)));this.path=new Degas.Path(s),this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Degas.RegularPolygon.prototype=new Degas.BaseShape,Degas.Image=function(t,e){var i=this;this.type="Image",this.src=t||"",this.loaded=!1,this.img=new Image,this.img.onload=function(){i.loaded=!0,i.width=i.img.width,i.height=i.img.height,void 0!=e&&e(i)},""!=this.src&&(this.img.src=this.src),this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Degas.Image.prototype=new Degas.BaseShape,Degas.Sprite=function(t,e,i,s,o,h,a){var n=this;this.type="Sprite",this.src=t||"",this.loaded=!1,this.img=new Image,this.frames=s,this.loop=h||!1,this.width=e,this.height=i,this.pWidth,this.pHeight,this.currentFrame=0,this.reverse=!1,this.fps=o||30,this.interval,this.img.onload=function(){n.loaded=!0,n.pWidth=n.img.width,n.pHeight=n.img.height,void 0!=a&&a(n)},""!=this.src&&(this.img.src=this.src),this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Degas.Sprite.prototype=new Degas.BaseShape,Degas.Sprite.prototype.nextFrame=function(){this.currentFrame<this.frames-1?this.currentFrame++:this.loop?this.currentFrame=0:this.stop()},Degas.Sprite.prototype.prevFrame=function(){this.currentFrame>0?this.currentFrame--:this.loop?this.currentFrame=this.frames-1:this.stop()},Degas.Sprite.prototype.render=function(){this.reverse?this.prevFrame():this.nextFrame()},Degas.Sprite.prototype.play=function(){var t=this;void 0==this.interval&&(this.interval=setInterval(function(){t.render()},1e3/this.fps))},Degas.Sprite.prototype.stop=function(){var t=this;clearInterval(t.interval),t.interval=void 0},Degas.Sprite.prototype.gotoAndPlay=function(t){t>-1&&t<this.frames-1&&(this.currentFrame=t,this.loop=!1,this.play())},Degas.Sprite.prototype.gotoAndStop=function(t){t>-1&&t<this.frames-1&&(this.currentFrame=t,this.loop=!1,this.stop())},Degas.Text=function(t,e){this.type="Text",this.txt=t,this.fontFamily=e.fontFamily||"Arial",this.fontSize=e.fontSize||"16px",this.fontStyle=e.fontStyle||"normal",this.textAlign=e.textAlign||"center",this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Degas.Text.prototype=new Degas.BaseShape,Degas.Path=function(t){this.type="Path",this.points=t,this.smoothedPoints,this.smoothed=!1,this.closed=!1,this.tension=.5,this.smoothPointsNumber=16,this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Degas.Path.prototype=new Degas.BaseShape,Degas.Path.prototype.smooth=function(){var t=[];this.closed&&(t.push(this.points[this.points.length-1].x),t.push(this.points[this.points.length-1].y));for(var e=0;e<this.points.length;e++)t.push(this.points[e].x),t.push(this.points[e].y);this.closed&&(t.push(this.points[0].x),t.push(this.points[0].y),t.push(this.points[1].x),t.push(this.points[1].y));var i=Degas.smoothPath(t,this.tension,!1,this.smoothPointsNumber);this.smoothedPoints=[];for(var e=0;e<i.length;e+=2)this.smoothedPoints.push(new Degas.Point(i[e],i[e+1]));this.smoothed=!0},Degas.Path.prototype.unSmooth=function(){this.smoothed=!1},Degas.Path.prototype.add=function(t){this.points.push(t)},Degas.Path.prototype.shuffle=function(t){for(var e=0;e<this.points.length;e++)this.points[e].moveRandom(t)},Degas.Arc=function(t,e,i,s){this.type="Arc",this.startAngle=t||0,this.endAngle=e||45,this.radius=i||50,this.antiClockwise=s||!1,this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Degas.Arc.prototype=new Degas.BaseShape,Degas.Point=function(t,e){this.type="Point",this.x=t||0,this.y=e||0},Degas.Point.prototype.moveRandom=function(t){this.x+=Math.round(Math.random()*(2*t))-t,this.y+=Math.round(Math.random()*(2*t))-t},Degas.Group=function(){this.uid=0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.opacity=1,this.events={mouseover:{fired:!1,callback:void 0},mouseout:{fired:!1,callback:void 0},click:{fired:!1,callback:void 0}}},Degas.Group.prototype.add=function(t){t.group=this},Degas.Group.prototype.remove=function(t){t.group=void 0},Degas.smoothPath=function(t,e,i,s){e="undefined"!=typeof e?e:.5,i=i?i:!1,s=s?s:16;var o,h,a,n,r,c,l,d,u,p,g,m,v,f=[],y=[];for(f=t.slice(0),i?(f.unshift(f[f.length-1]),f.unshift(f[f.length-2]),f.unshift(f[f.length-1]),f.unshift(f[f.length-2]),f.push(f[0]),f.push(f[1])):(f.unshift(f[1]),f.unshift(f[0]),f.push(f[f.length-2]),f.push(f[f.length-1])),v=2;v<f.length-4;v+=2)for(m=0;s>=m;m++)a=(f[v+2]-f[v-2])*e,n=(f[v+4]-f[v])*e,r=(f[v+3]-f[v-1])*e,c=(f[v+5]-f[v+1])*e,g=m/s,l=2*Math.pow(g,3)-3*Math.pow(g,2)+1,d=-(2*Math.pow(g,3))+3*Math.pow(g,2),u=Math.pow(g,3)-2*Math.pow(g,2)+g,p=Math.pow(g,3)-Math.pow(g,2),o=l*f[v]+d*f[v+2]+u*a+p*n,h=l*f[v+1]+d*f[v+3]+u*r+p*c,y.push(o),y.push(h);return y},Degas.degreeToRadian=function(t){return t*Math.PI/180},Degas.radianToDegree=function(t){return 180*t/Math.PI},Degas.distanceBetween=function(t,e){var i=0,s=0;return i=e.x-t.x,i*=i,s=e.y-t.y,s*=s,Math.sqrt(i+s)},Degas.pointInPolygon=function(t,e){for(var i=!1,s=-1,o=t.length,h=o-1;++s<o;h=s)(t[s].y<=e.y&&e.y<t[h].y||t[h].y<=e.y&&e.y<t[s].y)&&e.x<(t[h].x-t[s].x)*(e.y-t[s].y)/(t[h].y-t[s].y)+t[s].x&&(i=!i);return i};